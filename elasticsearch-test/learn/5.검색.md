## Reference

[시작하세요!엘라스틱 서치](http://book.naver.com/bookdb/book_detail.nhn?bid=8769630)

## 5. 검색

- REST API에 문자열 형식의 매개변수를 이용한 URI
- http 데이터를 이용한 리퀘스트 바디(request body)


> insert data

<pre>
[root@localhost elasticsearch-2.4.4]# curl -XPOST localhost:9200/_bulk --data-binary @datas/5_1_books.json
{"took":586,"errors":false,"items":[{"create":{"_index":"books",
...
"_id":"AV3bYAfGZzdBqJ5zrYAB","_version":1,"_shards":{"total":2,"successful":1,"failed":0},"status":201}}]}
</pre>

<pre>
[root@localhost elasticsearch-2.4.4]# curl -XPOST localhost:9200/_bulk --data-binary @datas/5_2_magazines.json
{"took":132,"errors":false,"items":[{"create":{"_index":"magazines"
...
"_id":"AV3bYRmjZzdBqJ5zrYAF","_version":1,"_shards":{"total":2,"successful":1,"failed":0},"status":201}}]}
</pre>


### 5.1 검색(_search) API

> books 인덱스의 book 타입에서 hamlet 이라는 검색어로 검색

<pre>
[root@localhost elasticsearch-2.4.4]# curl 'localhost:9200/books/book/_search?q=hamlet&pretty'
{
  "took" : 76,
  "timed_out" : false,
  "_shards" : {
    "total" : 5,
    "successful" : 5,
    "failed" : 0
  },
  "hits" : {
    "total" : 1,
    "max_score" : 0.37037593,
    "hits" : [ {
      "_index" : "books",
      "_type" : "book",
      "_id" : "AV3bYAfGZzdBqJ5zrX_3",
      "_score" : 0.37037593,
      "_source" : {
        "title" : "Hamlet",
        "author" : "William Shakespeare",
        "category" : "Tragedies",
        "written" : "1599-06-01T12:34:00",
        "pages" : 172,
        "sell" : 146100000,
        "plot" : "The protagonist of Hamlet is Prince Hamlet of Denmark, son of the recently deceased King Hamlet, and nephew of King Claudius, his father's brother and successor. Claudius hastily married King Hamlet's widow, Gertrude, Hamlet's mother. Denmark has a long-standing feud with neighbouring Norway, and an invasion led by the Norwegian prince, Fortinbras, is expected."
      }
    } ]
  }
}
</pre>

> books 인덱스 단위로 검색

<pre>
[root@localhost elasticsearch-2.4.4]# curl 'localhost:9200/books/_search?q=hamlet&pretty'
..위와 같음..
</pre>

- took : 검색에 소요 된 시간(millis)

> 멀티 테넌시(multi tenancy)

<pre>
[root@localhost elasticsearch-2.4.4]# curl 'localhost:9200/books,magazines/_search?q=time&pretty'
{
  "took" : 7,
  "timed_out" : false,
  "_shards" : {
    "total" : 10,
    "successful" : 10,
    "failed" : 0
  },
  "hits" : {
    "total" : 6,
    "max_score" : 0.20909351,
    "hits" : [ {
      ...

}
</pre>


> 전체 클러스터 검색

<pre>
[root@localhost elasticsearch-2.4.4]# curl 'localhost:9200/_all/_search?q=time&pretty'
or
[root@localhost elasticsearch-2.4.4]# curl 'localhost:9200/_search?q=time&pretty'
{
  "took" : 8,
  "timed_out" : false,
  "_shards" : {
    "total" : 10,
    "successful" : 10,
    "failed" : 0
  },
  "hits" : {
    "total" : 6,
    "max_score" : 0.20909351,
    "hits" : [ {
      ....
}
</pre>



### 5.2. URI 검색
