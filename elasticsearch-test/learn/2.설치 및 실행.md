## 설치

<http://www.elasticsearch.com>

## 실행 
<code>
#/root/elasticsearch/elasticsearch-2.4.4/bin/elasticsearch -Des.insecure.allow.root=true -d -p es.pid
</code>

- -Des.insecure.allow.root=true : 루트로 실행
- -d : 백그라운드로 실행
- -p <파일명> : 엘라스틱서치의 프로세스 id를 <파일명>으로 지정된 파일에 저장

### 간단 쉘 스크립트

**start.sh**

<code>
echo "Start to ElasticSearch"
$ES_HOME/bin/elasticsearch -Des.insecure.allow.root=true -d -p $ES_HOME/logs/es.pid
</code>

**stop.sh**

<code>
echo 'Terminate Elastic Search'
kill `cat $ES_HOME/logs/es.pid`
</code>

### 프로세스 정보

<code>
[root@localhost elasticsearch-2.4.4]# curl -XGET http://localhost:9200
{
  "name" : "Bug",
  "cluster_name" : "my-elastic",
  "cluster_uuid" : "tNZ4A1a9TS-ioxIE2TpdYw",
  "version" : {
    "number" : "2.4.4",
    "build_hash" : "fcbb46dfd45562a9cf00c604b30849a6dec6b017",
    "build_timestamp" : "2017-01-03T11:33:16Z",
    "build_snapshot" : false,
    "lucene_version" : "5.5.2"
  },
  "tagline" : "You Know, for Search"
}
</code>

<hr />

## 로그

<code>
#tail -100f logs/elasticsearch.log
</cdoe>

<hr />

## 엘라스틱 서치 프로그램 구조

(bin/ , config/ , lib/)

**bin/**

- elasticsearch.in.sh <br />
	: 엘라스틱 서치를 실행하기 위한 자바의 실행 변수에 대한 내용이 있는 설정 파일
- plugin <br />
	: 플러그인을 설치하기 위한 실행 파일
	
	
**config/**

- elasticsearch.yml
- logging.yml

**lib/**

- lucene-*.jar 
- elasticsearch-*.jar


**실행 옵션 설명(ps -ef | grep elasticsearch)**

- /usr/java/jdk/bin/java <br />
	: 자바 프로그램을 실행
	
- -Xms256m -Xmx1g<br />
	: 최대/최소 메모리
- -Des.path.home=/root/elasticsearch/elasticsearch-2.4.4<br />
	: 엘라스틱 서치 설치 경로	
- -cp ...<br />
	: jar 라이브러리 파일 지정
	
	
**logs/**

-  my-elastic_index_indexing_slowlog.log, my-elastic_index_search_slowlog.log <br />
	: 검색과 색인이 일정 시간 이상 소요됐을 때, 느린 속도로 실행된 내용을 기록하는 슬로우 파일

**data/**

; 실제 색인된 문서의 검색 데이터가 저장되는 공간(별도 설정 X) <br />
=> ES 실행 설치 경로와 데이터가 저장되는 저장소를 분리하는 것이 바람직! <br />
=> tree 명령어로 확인해보면 많은 디렉터리 존재
 
- elasticsearch <br />
	: 실행된 엘라스틱서치의 클러스터명
	

## 환경 설정 

- elasticsearch.in.sh , elasticsearch.yml 파일 내용 변경
- 엘라스틱서치 실행 시 -D* or --* 옵션 이용
- 엘라스틱서치 실행 후 REST API를 이용

<hr />


### 2.3.1 bin/elasticsearch.in.sh

**최대 최소 메모리 옵션**

<code>
#vi bin/elasticsearch.in.sh 

if [ "x$ES_MIN_MEM" = "x" ]; then
    ES_MIN_MEM=256m
fi
if [ "x$ES_MAX_MEM" = "x" ]; then
    ES_MAX_MEM=1g
fi
if [ "x$ES_HEAP_SIZE" != "x" ]; then
    ES_MIN_MEM=$ES_HEAP_SIZE
    ES_MAX_MEM=$ES_HEAP_SIZE
fi

</code>

=> 위의 설정이, ES_MIN_MEM == -Xms256m , ES_MAX_MEM == -Xmx1g 옵션 값이 됨

=> 맨위 ES_HEAP_SIZE=1g 설정하면, 최소,최대 1g 로 설정 


**힙 덤프 파일**

<code>
#vi bin/elasticsearch.in.sh

JAVA_OPTS="$JAVA_OPTS -XX:HeapDumpPath=$ES_HOME/logs/heapdump.hprof"
</code>

=> 자바 힙 메모리 오류 관련


### 2.3.2 config/elasticsearch.yml

**클러스터**

<code>
#cluster.name: elastic
cluster:
	name: es_test
#cluster.name:elast // error!
</code>

=> 클러스터는 엘라스틱서치 시스템 전체를 구분 짓는 이름이므로, 처음에 바꿔주는 게 좋음

확인
<code>
#curl -XGET localhost:9200/_cluster/stats?pretty=true
</code>


**노드**

<code>
# node.name: node-1
</code>

=> 실행 된 하나의 엘라스틱서치 프로세스를 한 노드라 하고, 각 노드가 연결된 전체 

시스템을 엘라스틱서치 클러스트라고 함.

<code>
node.name: "Node1"
</code>

=> 실행하면, [Node1]로 실행 됨



**인덱스**

- #index.number_of_shards: 5 // 샤드 개수
- #index.number_of_replicas: 1 // 복사본 개수



**경로**

- #path.confg: /path/to/conf <br />
	: config/ 설정 파일 경로
- #path.data: /path/to/data <br />
	: data/ 데이터 파일 경로
- #path.work: /path/to/work <br />
	: 임시 작업 파일 경로
- #path.logs: /path/to/logs <br />
	: logs/ 로그 파일 경로
- #path.plugins: /path/to/plugins <br />
	: 플러그인이 설치되는 경로
	
	
**플러그인**

- #plugin.mandatory: mapper-attachments,lang-grooby <br />
	: 쉼표로 여러 개의 플러그인 지정
	
	
	
**메모리**

- #bootstrap.memory_lock: true <br />
	: 자바 가상 머신 위에서 실행 중인 엘라스틱서치가 점유하는 메모리를 고정<br />
=> JVM이 엘라스틱서치가 사용하지 않는 메모리를 다른 자바 프로그램으로 돌리는(swap)것을 방지 가능 <br />
=> 엘라스틱 서치에서 메모리가 부족하지 않도록 방지할 수 있으므로 true를 추천. <br />
=> 시스템의 메모리 용량을 충분히 고려해 시스템 전체 메모리의 50%를 넘지 않도록 하는 것이 안정적.



**HTTP네트워크**


 
 
	
	
	

	 
	 





















 
 



	
	
	
	
	
	
	